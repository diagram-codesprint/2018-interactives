<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8"/>
  <title>Listbox Example | WAI-ARIA Authoring Practices 1.1</title>

  <!--  Core js and css shaby all examples; do not modify when using this template. -->
  <link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/base.css">
  <script src="js/utils.js" type="text/javascript"></script>

  <link href="css/listbox.css" rel="stylesheet">
  <script src="js/listbox.js" type="text/javascript"></script>
  <script type="text/javascript">

    /**
     * ARIA Listbox Examples
     * @function onload
     * @desc Initialize the listbox examples once the page has loaded
     */

    window.addEventListener( 'load', function() {
      var bucketListbox = new aria.Listbox( document.getElementById( 'bucket_list' ) );
      var bag0Listbox = new aria.Listbox( document.getElementById( 'bag0_list' ) );

      var bucketAddButton = document.getElementById( 'bucket-add' );
      bucketListbox.setupDelete( bucketAddButton, bag0Listbox );
      var bag0RemoveButton = document.getElementById( 'bag0-remove' );
      bag0Listbox.setupDelete( bag0RemoveButton, bucketListbox );

      var bag1Listbox = new aria.Listbox( document.getElementById( 'bag1_list' ) );
      var ropeBucketListbox = new aria.Listbox( document.getElementById( 'rope-bucket_list' ) );

      var bag1RemoveButton = document.getElementById( 'bag1-remove' );
      bag1Listbox.setupDelete( bag1RemoveButton, ropeBucketListbox );
      var ropeBucketAddButton = document.getElementById( 'rope-bucket-add' );
      ropeBucketListbox.setupDelete( ropeBucketAddButton, bag1Listbox );

      function MyBag() {

        var self = this;
        this.listboxes = [];

        // {Array.<HTMLElement>} list of all list items that should be in every bag listbox
        this.data = [];

        var setId = function( oldId, prefix ) {
          return prefix + '_' + oldId.split( '_' )[ 1 ];
        };

        var cloneHTMLElement = function( htmlElement, idPrefix ) {
          var element = document.createElement( htmlElement.tagName );


          for ( var i = 0, atts = htmlElement.attributes, n = atts.length; i < n; i++ ) {
            var attribute = atts[ i ];
            if ( attribute.name === 'id' ) {
              var id = attribute.nodeValue;

              // this assumes li elements only have one underscore in it.
              element.setAttribute( 'id', setId( id, idPrefix  ) );

            }
            // else if ( attribute.name === 'class' ) {
              // element.setAttribute( attribute.name, attribute.nodeValue.replace, '' ) );

            // }
            else {
              element.setAttribute( attribute.name, attribute.nodeValue );

            }
          }
          element.innerHTML = htmlElement.innerHTML;

          return element;
        };

        var cloneHTMLElements = function( list, idPrefix ) {

          var clone = [];

          list.forEach( function( item ) {
            clone.push( cloneHTMLElement( item, idPrefix ) );
          } );

          return clone;
        };

        this.renderBagContents = function() {
          this.listboxes.forEach( function( listbox ) {

            var node = listbox.listboxNode;

            // clone self.data for this listbox:
            var dataClone = [];
            self.data.forEach( function( item ) {
              dataClone.push( cloneHTMLElement( item, listbox.listboxNode.id ) );
            } );


            if( listbox.activeDescendant){
              var listboxId = setId( listbox.activeDescendant, listbox.listboxNode.id  );
              listbox.activeDescendant = listboxId;
              node.setAttribute( 'aria-activedescendant', listboxId );
            }

            // iterate through ul children and set all to aria-selected="true"
            for ( var liChild of node.children ) {

              liChild.setAttribute( 'aria-selected', 'true' );
            }


            // delete all from the listbox
            listbox.deleteItems();


            // add all elements from data
            listbox.addItems( dataClone );
          } );
        };

        this.update = function( liItems ) {
          self.data = cloneHTMLElements( liItems, 'data' );
          self.renderBagContents();
        };
      }


      var bag = new MyBag();
      bag.listboxes = [ bag0Listbox, bag1Listbox ];

      bucketAddButton.addEventListener( 'click', function() {
        var liItems = Array.prototype.slice.call( bag0Listbox.listboxNode.children );
        bag.update( liItems );
      } );
      ropeBucketAddButton.addEventListener( 'click', function() {
        var liItems = Array.prototype.slice.call( bag1Listbox.listboxNode.children );
        bag.update( liItems );
      } );

      bag0RemoveButton.addEventListener( 'click', function() {
        var liItems = Array.prototype.slice.call( bag0Listbox.listboxNode.children );
        bag.update( liItems );

      } );
      bag1RemoveButton.addEventListener( 'click', function() {

        var liItems = Array.prototype.slice.call( bag1Listbox.listboxNode.children );
        bag.update( liItems );
      } );
    } );
  </script>

</head>

<body>
<main>


  <section>
    <div role="separator" id="bucket_start_sep" aria-labelledby="bucket_start_sep bucket_label"
         aria-label="Start of"></div>
    <div id="bucket-interaction">
      <div class="listbox-area">
        <div class="left-area">
          <span id="bucket">Red bucket</span>
          <ul id="bucket_list" tabindex="0" role="listbox" aria-labelledby="bucket" aria-multiselectable="true">
            <li id="bucket_opt1" role="option" aria-selected="false" class="puller-large">Large Puller</li>
            <li id="bucket_opt2" role="option" aria-selected="false" class="puller-small">Small Puller</li>
            <li id="bucket_opt3" role="option" aria-selected="false" class="puller-small">Small Puller</li>
            <li id="bucket_opt4" role="option" aria-selected="false" class="puller-medium">Medium Puller</li>
          </ul>
          <button id="bucket-add" class="move-right-btn" aria-keyshortcuts="Alt+ArrowRight Delete" aria-disabled="true">
            Add
          </button>
        </div>
        <div class="right-area">
          <span id="bag0-label">My bag</span>
          <ul id="bag0_list" tabindex="0" role="listbox" aria-labelledby="rope-bucket-label" aria-activedescendant=""
              aria-multiselectable="true">
          </ul>
          <button id="bag0-remove" class="move-left-btn" aria-keyshortcuts="Alt+ArrowLeft Delete" aria-disabled="true">
            Remove
          </button>
        </div>
      </div>
    </div>
    <div role="separator" id="bucket_end_sep" aria-labelledby="ex2_end_sep ex2_label" aria-label="End of"></div>


    <div role="separator" id="ex2_start_sep" aria-labelledby="ex2_start_sep ex2_label" aria-label="Start of"></div>
    <div id="rope-bucket">
      <div class="listbox-area">
        <div class="left-area">
          <span id="label_bucket">My bag</span>
          <ul id="bag1_list" tabindex="0" role="listbox" aria-labelledby="label_bucket" aria-multiselectable="true">
          </ul>
          <button id="bag1-remove" class="move-right-btn" aria-keyshortcuts="Alt+ArrowRight Delete"
                  aria-disabled="true">Remove
          </button>
        </div>
        <div class="right-area">
          <span id="rope-bucket-label">Red rope bucket</span>
          <ul id="rope-bucket_list" tabindex="0" role="listbox" aria-labelledby="rope-bucket-label"
              aria-activedescendant="" aria-multiselectable="true">
          </ul>
          <button id="rope-bucket-add" class="move-left-btn" aria-keyshortcuts="Alt+ArrowLeft Delete"
                  aria-disabled="true">Add
          </button>
        </div>
      </div>
    </div>
    <div role="separator" id="ex2_end_sep" aria-labelledby="ex2_end_sep ex2_label" aria-label="End of"></div>

  </section>
</main>
</body>

</html>